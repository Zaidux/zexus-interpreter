// Performance Test: 10,000 transactions
// Direct contract operations with storage batching

DATA GlobalStorage {
    balances: {}
}

ACTION transfer(from, to, amount) {
    // Get balances
    let from_balance = GlobalStorage.balances[from] || 0
    let to_balance = GlobalStorage.balances[to] || 0
    
    // Validate
    require(from_balance >= amount, "Insufficient balance")
    require(amount > 0, "Amount must be positive")
    
    // Update
    GlobalStorage.balances[from] = from_balance - amount
    GlobalStorage.balances[to] = to_balance + amount
    
    return {"success": true, "from": from, "to": to, "amount": amount}
}

// Initialize
GlobalStorage.balances["0xALICE"] = 100000000

// Run test
let start = time()
let count = 0
let target = 10000

storage_begin_batch()

while (count < target) {
    transfer("0xALICE", "0xUSER_" + string(count), 10)
    count = count + 1
}

storage_commit_batch()

let end = time()
let duration = end - start
let tps = target / duration

print("Processed " + string(target) + " transactions")
print("Duration: " + string(duration) + " seconds")
print("TPS: " + string(tps))
