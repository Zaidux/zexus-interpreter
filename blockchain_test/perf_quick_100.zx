// Quick Performance Test - 100 Transactions
// Testing current TPS with batching enabled (inline contract)

// Inline silent token contract (no print statements)
contract TokenSilent {
    data total_supply = 0
    data balances = {}
    
    action mint(to, amount) {
        let to_balance = balances[to]
        if to_balance == null {
            to_balance = 0
        }
        balances[to] = to_balance + amount
        total_supply = total_supply + amount
        return { "success": true, "amount": amount }
    }
    
    action balance_of(address) {
        if balances[address] == null {
            return 0
        }
        return balances[address]
    }
    
    action transfer(from, to, amount) {
        let from_balance = balances[from]
        if from_balance == null {
            from_balance = 0
        }
        
        if from_balance < amount {
            return { "success": false, "error": "Insufficient balance" }
        }
        
        balances[from] = from_balance - amount
        
        let to_balance = balances[to]
        if to_balance == null {
            to_balance = 0
        }
        balances[to] = to_balance + amount
        
        return { "success": true }
    }
}

print("\n" + "=" * 80)
print("  QUICK PERFORMANCE TEST - 100 Transactions")
print("  Testing storage batching performance")
print("=" * 80 + "\n")

// Setup
let token = TokenSilent()
token.mint("0xTEST", 100000)
print("✅ Token initialized with 100,000 ZXS\n")

print("Starting 100 transfer test...")
let start = time()

// Execute 100 transfers
let i = 0
let success = 0

while i < 100 {
    let addr = "0xUSER_" + string(i)
    let res = token.transfer("0xTEST", addr, 10)
    
    if res["success"] {
        success = success + 1
    }
    
    i = i + 1
}

let end = time()
let elapsed = end - start
let tps = (success * 1000) / elapsed

print("\n" + "=" * 80)
print("  RESULTS")
print("=" * 80)
print("  Transactions: " + string(success) + " / 100")
print("  Time: " + string(elapsed) + " ms (" + string(elapsed / 1000) + " seconds)")
print("  TPS: " + string(tps))
print("=" * 80)

// Verify balances
let final_balance = token.balance_of("0xTEST")
print("\n✅ Final sender balance: " + string(final_balance) + " ZXS")
print("✅ Expected: " + string(100000 - (100 * 10)) + " ZXS")

if final_balance == (100000 - 1000) {
    print("✅ Balance verification PASSED")
} else {
    print("❌ Balance verification FAILED")
}
