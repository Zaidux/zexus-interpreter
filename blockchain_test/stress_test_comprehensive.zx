// COMPREHENSIVE STRESS TEST - 10K to 1M Transactions
// Tests Zexus performance across multiple scales with complex operations

contract TokenStress {
    data balances = {}
    data total_supply = 0
    data transaction_count = 0
    data owner = ""
    
    action initialize(initial_owner) {
        owner = initial_owner
        balances[initial_owner] = 1000000000  // 1 billion tokens
        total_supply = 1000000000
        transaction_count = 0
    }
    
    action transfer(from, to, amount) {
        // Get balances (default to 0 if null)
        let from_balance = balances[from]
        if from_balance == null {
            from_balance = 0
        }
        let to_balance = balances[to]
        if to_balance == null {
            to_balance = 0
        }
        
        // Security checks (production-grade)
        require(amount > 0, "Amount must be positive")
        require(from_balance >= amount, "Insufficient balance")
        
        // Transfer
        balances[from] = from_balance - amount
        balances[to] = to_balance + amount
        transaction_count = transaction_count + 1
        
        return true
    }
}

// Helper function for generating unique addresses
action generate_address(index) {
    return "0xADDR_" + string(index)
}

// Test function - runs N transactions and measures performance
action run_stress_test(num_transactions) {
    print("=" * 80)
    print("STRESS TEST - " + string(num_transactions) + " Transactions")
    print("=" * 80)
    
    // Create contract
    let token = TokenStress()
    token.initialize("0xOWNER")
    
    // Track time
    let start_time = time()
    
    // Run transactions
    let count = 0
    let sender = "0xOWNER"
    let progress_interval = num_transactions / 10
    
    while count < num_transactions {
        // Generate unique recipient for each transaction
        let recipient = generate_address(count)
        
        // Transfer 100 tokens to unique address
        token.transfer(sender, recipient, 100)
        
        count = count + 1
        
        // Progress indicator every 10%
        if count % progress_interval == 0 {
            let progress = (count * 100) / num_transactions
            print("  Progress: " + string(progress) + "%")
        }
    }
    
    // Calculate performance
    let end_time = time()
    let duration_ms = end_time - start_time
    let duration_sec = duration_ms / 1000
    let tps = 0
    
    if duration_sec > 0 {
        tps = num_transactions / duration_sec
    }
    
    // Display results
    print("")
    print("RESULTS")
    print("=" * 80)
    print("  Transactions: " + string(num_transactions))
    print("  Time: " + string(duration_ms) + " ms (" + string(duration_sec) + " seconds)")
    print("  TPS: " + string(tps))
    print("  Avg time per tx: " + string(duration_ms / num_transactions) + " ms")
    print("=" * 80)
    print("")
    
    return {
        transactions: num_transactions,
        duration_ms: duration_ms,
        tps: tps
    }
}

// Main test suite
print("")
print("ZEXUS COMPREHENSIVE STRESS TEST")
print("Testing from 10K to 1M transactions")
print("Features: Security checks, unique addresses, VM auto-optimization")
print("")

// Test levels (start with 10K to validate, will run larger if time permits)
let test_levels = [10000]
let results = []

let test_index = 0
while test_index < len(test_levels) {
    let num_tx = test_levels[test_index]
    
    // Run test
    let result = run_stress_test(num_tx)
    results = append(results, result)
    
    test_index = test_index + 1
}

// Summary
print("")
print("=" * 80)
print("SUMMARY")
print("=" * 80)
print("")
print("| Transactions | Time (s) | TPS       |")
print("|--------------|----------|-----------|")

let summary_index = 0
while summary_index < len(results) {
    let r = results[summary_index]
    let tx = r.transactions
    let time_s = r.duration_ms / 1000
    let tps = r.tps
    
    print("| " + string(tx) + " | " + string(time_s) + " | " + string(tps) + " |")
    
    summary_index = summary_index + 1
}

print("")
print("âœ… STRESS TEST COMPLETE")
print("="  * 80)
