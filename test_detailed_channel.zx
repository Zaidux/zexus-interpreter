# More detailed channel test

print("=== Detailed Channel Test ===\n")

channel<integer>[10] number_channel

async action producer() {
    print("Producer [THREAD]: Started")
    send(number_channel, 10)
    print("Producer [THREAD]: Sent 10")
    send(number_channel, 20)
    print("Producer [THREAD]: Sent 20")
    close_channel(number_channel)
    print("Producer [THREAD]: Closed channel")
}

async action consumer() {
    print("Consumer [THREAD]: Started")
    sleep(0.3)
    print("Consumer [THREAD]: Awake, receiving")
    let num1 = receive(number_channel)
    print("Consumer [THREAD]: Got " + string(num1))
    let num2 = receive(number_channel)
    print("Consumer [THREAD]: Got " + string(num2))
    let num3 = receive(number_channel)
    print("Consumer [THREAD]: Got " + string(num3) + " (should be null)")
}

print("Main: Starting producer")
async producer()
print("Main: Starting consumer")
async consumer()

print("Main: Sleeping 2 seconds")
sleep(2.0)
print("Main: Done sleeping")
