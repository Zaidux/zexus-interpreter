# Test async with async action
print("=== Async Action Test ===\n")

channel<integer> test_chan

async action producer() {
    print("Producer: Sending 10...")
    send(test_chan, 10)
    print("Producer: Sending 20...")
    send(test_chan, 20)
    print("Producer: Done")
    close_channel(test_chan)
}

async action consumer() {
    print("CONSUMER: Function entry point")
    print("Consumer: Waiting for first value...")
    let val1 = receive(test_chan)
    print("Consumer received: " + string(val1))
    
    print("Consumer: Waiting for second value...")
    let val2 = receive(test_chan)
    print("Consumer received: " + string(val2))
    
    print("Consumer: Done")
}

print("Starting async tasks...")
async producer()
print("Producer task started")
async consumer()
print("Consumer task started")

print("Waiting for completion...")
sleep(2)
print("Test complete")
